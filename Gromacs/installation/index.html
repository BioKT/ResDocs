<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation - Research Toolbox</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Research Toolbox</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="../../about">About</a>
            </li>
        

    
        
        <span>Gromacs</span>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Installation</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#gromacs-installation-in-mac-os-x">Gromacs installation in Mac OS X</a></li>
                            
                                <li><a class="toctree-l3" href="#building-gromacs-4-using-make">Building Gromacs 4.* using MAKE</a></li>
                            
                                <li><a class="toctree-l3" href="#building-gromacs-5-using-cmake">Building Gromacs 5.* using CMAKE</a></li>
                            
                        
                        </ul>
                    
                </li>
            
        

    
        
        <span>MacOSX</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../MacOSX/hacks">Hacks</a>
                    
                </li>
            
        

    
        
        <span>PBS</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../PBS/archer">Archer</a>
                    
                </li>
            
        

    
        
        <span>VMD</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../VMD/tools">Tools</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Installation</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h1 id="gromacs-installation-in-mac-os-x">Gromacs installation in Mac OS X</h1>
<h2 id="building-gromacs-4-using-make">Building Gromacs 4.* using MAKE</h2>
<p>One of the prerequisites for the installation are the fftw libraries for
doing Fourier transforms. Setting these up correctly seems to be limiting, 
as in the <code>configure</code> step Gromacs struggled to find the Macports libraries.
So first of all, download 
<a href="ftp://ftp.gromacs.org/pub/prerequisite_software/fftw-3.0.1.tar.gz">fftw-3.0.1.tar.gz</a> 
on your computer. Then you can simply install as</p>
<pre><code>./configure --enable-float --enable-threads
make
sudo make install
</code></pre>

<p>Then you can download the source code and proceed to install Gromacs in the usual 
way</p>
<pre><code>./configure --prefix=/usr/local/gromacs/4.0.5 --enable-threads --enable-float
make
sudo make install
</code></pre>

<p>On occasion I have found this install to give Segmentation Faults or not work. 
In order to make it work it needed a little tweaking, making explicit the compiler
and including additional flags, all of which may make a difference</p>
<pre><code>CFLAGS=&quot;-m64 -U_FORTIFY_SOURCE&quot;; ./configure --prefix=/usr/local/gromacs/4.0.5 --enable-threads --enable-floats --enable-apple-64bit
make
sudo make install
</code></pre>

<p>I still need to work out how to make this run in parallel on a Mac.</p>
<h2 id="building-gromacs-5-using-cmake">Building Gromacs 5.* using CMAKE</h2>
<p>(These instructions were borrowed from 
<a href="http://philipwfowler.me/">Phillip W Fowler´s</a> blog).</p>
<p>Prerequisites for the installation are the gcc compilers available at MacPorts.
This requires you to first install Xcode.</p>
<p>Then the most important thing is to download the source code from the Gromacs 
website and unpack the software.</p>
<pre><code>tar xvf gromacs-5.0.4.tar.gz
cd gromacs-5.0.4
mkdir build
</code></pre>

<p>Then we start with the interestign stuff. In the last few versions Gromacs
has made a transition towards using cmake instead of make. Cmake is readily 
available for Mac OS X, so no problem with this. Then you must run the following
in the command line:</p>
<pre><code>cmake .. -DGMX_BUILD_OWN_FFTW=ON -DCMAKE_INSTALL_PREFIX='/usr/local/gromacs/5.0.4/'
make
sudo make install
</code></pre>

<p>This will install the program in <code>/usr/local/gromacs/5.0.4</code>, and editing your <code>.bashrc</code>
file you will be able to choose the version of Gromacs that is running.</p>
<p>Adding MPI support on a Mac is trickier. This appears mainly to be because the gcc 
compilers from MacPorts  do not appear to support OpenMPI. Here is a workaround </p>
<pre><code>sudo port install openmpi
</code></pre>

<p>Now we need a compiler that supports OpenMPI</p>
<pre><code>sudo port install openmpi-devel-gcc49
</code></pre>

<p>Finally, we can follow the steps above but now we need a more complex cmake instruction</p>
<pre><code>cmake .. -DGMX_BUILD_OWN_FFTW=ON
    -DGMX_BUILD_MDRUN_ONLY=on
    -DCMAKE_INSTALL_PREFIX=/usr/local/gromacs/5.0.4
    -DGMX_MPI=ON -DCMAKE_C_COMPILER=mpicc-openmpi-devel-gcc49
    -DCMAKE_CXX_COMPILER=mpicxx-openmpi-devel-gcc49
    -DGMX_SIMD=SSE4.1
make
sudo make install-mdrun
</code></pre>

<p>This is only going to build an MPI version of <code>mdrun</code>, as the other Gromacs programs do not
run in parallel. We have to tell cmake what all the new fancy compilers are called and, 
unfortunately, these don’t support AVX SIMD instructions so we have to fall back to SSE4.1. 
Experience suggests this doesn’t impact performance as much as you might think.</p>
<p>For a previous version of Gromacs (4.6.7) that also happens to be installed using cmake I have
found this method not to work well. Instead I did something apparently simpler which did work.</p>
<pre><code>CC=mpicc CXX=mpiCC cmake .. -DGMX_BUILD_OWN_FFTW=ON -DCMAKE_INSTALL_PREFIX=/usr/local/gromacs/4.6.7 -DGMX_MPI=ON
</code></pre>

<p>And then one would continue with the <code>make</code> and <code>make install-mdrun</code> steps as before. This allowed 
for running jobs using the <code>mpirun</code> command as</p>
<pre><code>mpirun -np 12 mdrun_mpi -v $OPTIONS
</code></pre>


            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../MacOSX/hacks" class="btn btn-neutral float-right" title="Hacks"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../about" class="btn btn-neutral" title="About"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="../../about" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../../MacOSX/hacks" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>